@RestController
@RequestMapping("/api/orders")
public class OrderController {

    @GetMapping("/frontend/orders")
    public ResponseEntity<List<Map<String, Object>>> getOrdersFrontend() {
        try {
            System.out.println("üìã Frontend: Retrieving orders with real data");

            List<Map<String, Object>> orders = orderService.getRecentOrders();

            System.out.println("‚úÖ " + orders.size() + " orders returned");
            return ResponseEntity.ok(orders);

        } catch (Exception e) {
            System.err.println("‚ùå Error retrieving orders: " + e.getMessage());
            return ResponseEntity.status(500).body(new ArrayList<>());
        }
    }

    @GetMapping("/frontend/orders/{id}/cards")
    public ResponseEntity<Map<String, Object>> getOrderCards(@PathVariable String id) {
        try {
            System.out.println("üÉè Frontend: Retrieving cards for order: " + id);

            String sql = """
            SELECT
                HEX(cc.id) as cardId,
                cc.barcode as barcode,
                COALESCE(cc.type, 'Pokemon') as type,
                cc.card_id as cardId,
                COALESCE(cc.annotation, '') as annotation,
                COALESCE(ct.name, CONCAT('Pokemon Card ', cc.barcode)) as name
            FROM card_certification_order cco
            INNER JOIN card_certification cc ON cco.card_certification_id = cc.id
            LEFT JOIN card_translation ct ON cc.card_id = ct.translatable_id
            WHERE HEX(cco.order_id) = ?
            """;

        } catch (Exception e) {
            System.err.println("‚ùå Error loading cards: " + e.getMessage());
            return ResponseEntity.status(500).body(Map.of("error", e.getMessage()));
        }
    }
}